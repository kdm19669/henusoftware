#  å°ç±³æ±½è½¦äºŒé¢ #

## springbootçš„å¯åŠ¨æµç¨‹ ##

æˆ‘çš„ç†è§£æ˜¯springbootçš„å¯åŠ¨æµç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸ƒä¸ªé˜¶æ®µï¼š

ç¬¬ä¸€ä¸ªé˜¶æ®µï¼š**åˆ›å»º SpringApplication å®ä¾‹**ï¼Œç¡®å®šåº”ç”¨ç±»å‹ï¼ŒåŠ è½½åˆå§‹åŒ–å™¨ã€ç›‘å¬å™¨ï¼Œå¹¶æ‰¾åˆ°ä¸»ç±»ã€‚
ç¬¬äºŒä¸ªé˜¶æ®µï¼š**å‡†å¤‡ç¯å¢ƒå˜é‡**ï¼Œè¯»å–é…ç½®æ–‡ä»¶ï¼Œè§£æå‘½ä»¤è¡Œå‚æ•°ã€‚
ç¬¬ä¸‰ä¸ªé˜¶æ®µï¼š**åˆ›å»º Spring å®¹å™¨**ï¼Œå†³å®š Web æˆ–é Web å®¹å™¨ã€‚
ç¬¬å››ä¸ªé˜¶æ®µï¼š**åŠ è½½ Bean å¹¶åˆ·æ–°å®¹å™¨**ï¼Œå®Œæˆ Bean åŠ è½½ã€è‡ªåŠ¨é…ç½®ç­‰æ ¸å¿ƒé€»è¾‘ã€‚
ç¬¬äº”ä¸ªé˜¶æ®µï¼š**å¯åŠ¨ Web æœåŠ¡å™¨**ï¼ˆè‹¥ä¸º Web åº”ç”¨ï¼‰ï¼Œåˆå§‹åŒ– DispatcherServletã€‚
ç¬¬å…­ä¸ªé˜¶æ®µï¼š**å›è°ƒé€»è¾‘ï¼š**åº”ç”¨æ­£å¼è¿è¡Œå‰ï¼Œå¯ä»¥**è¿è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚**
ç¬¬ä¸ƒä¸ªé˜¶æ®µï¼š**å‘å¸ƒäº‹ä»¶**ï¼Œå®Œæˆå¯åŠ¨

è¿™æ ·ï¼ŒSpring Boot å°±å®Œæˆäº†å¯åŠ¨æµç¨‹ï¼Œå¹¶å‡†å¤‡æ¥å—è¯·æ±‚ã€‚

é‚£ä¹ˆåœ¨ä»£ç å±‚é¢ï¼Œ

springbooté¡¹ç›®æœ‰ä¸€ä¸ª**å¯åŠ¨ç±»**ï¼Œå¯åŠ¨ç±»ç”¨æ³¨è§£`@SpringBootApplication`æ ‡æ³¨ï¼Œå¯åŠ¨ç±»æ˜¯æ•´ä¸ªé¡¹ç›®çš„å…¥å£ï¼Œè€Œå¯åŠ¨ç±»ä¸­çš„ä¸€ä¸ª`run`æ–¹æ³•åˆæ˜¯ä¸€ä¸ªå…¥å£ï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œè¿™ä¸ª**runæ–¹æ³•**ã€‚ä½†æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªrunæ–¹æ³•ä¹‹å‰ï¼Œä¼š**åˆ›å»ºSpringApplicationå®ä¾‹**ï¼Œä¹Ÿå°±æ˜¯newä¸€ä¸ª`SpringApplication`å¯¹è±¡ï¼Œåœ¨åˆ›å»ºå®ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯åœ¨æ„é€ æ–¹æ³•å†…ï¼ŒSpringBoot ä¼šè¿›è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–æ“ä½œã€‚é¦–å…ˆï¼Œå®ƒä¼šç¡®å®šåº”ç”¨çš„ç±»å‹` WebApplicationType.deduceFromClasspath()` ï¼Œæ£€æŸ¥ç±»è·¯å¾„ï¼Œåˆ¤æ–­æ˜¯ Web åº”ç”¨ è¿˜æ˜¯ æ™®é€šåº”ç”¨ï¼Œä»è€Œé€‰æ‹©åˆé€‚çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆ`ApplicationContext`ï¼‰ã€‚æ¥ç€ï¼Œå®ƒä¼š åŠ è½½åˆå§‹åŒ–å™¨ï¼ˆInitializerï¼‰`ApplicationContextInitializer` å’Œ ç›‘å¬å™¨ï¼ˆListenerï¼‰`ApplicationListener`ã€‚*ï¼Ÿ*

*ï¼Ÿ* åœ¨å®Œæˆè¿™äº›å‡†å¤‡å·¥ä½œåï¼ŒSpring Boot æ­£å¼å¼€å§‹æ‰§è¡Œ `run` æ–¹æ³•ã€‚åœ¨ `run` æ–¹æ³•å†…éƒ¨ï¼Œé¦–å…ˆä¼š **å‡†å¤‡è¿è¡Œç¯å¢ƒ**ï¼Œä¹Ÿå°±æ˜¯è§£æ `application.yml` æˆ– `application.properties` é…ç½®æ–‡ä»¶ï¼Œå¹¶ç»“åˆç³»ç»Ÿç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°ç­‰ï¼Œæ„é€  `Environment` å¯¹è±¡ã€‚éšåï¼ŒSpring Boot ä¼š **åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡**ï¼ˆApplicationContextï¼‰`createApplicationContext();`ï¼Œå³ Spring å®¹å™¨ï¼Œå¹¶æ ¹æ®é¡¹ç›®ç±»å‹é€‰æ‹©åˆé€‚çš„å®ç°ã€‚

å½“ `ApplicationContext` åˆ›å»ºå®Œæˆåï¼Œä¼šæ‰§è¡Œ`context.refresh()`è¿™ä¸ªæ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•å†…ï¼Œä¼šæ‰«æ @Component æ³¨è§£çš„ç±»ï¼Œå®Œæˆä¾èµ–æ³¨å…¥ï¼Œæ‰§è¡Œ AOP ä»£ç†ï¼Œè§£æ @Configuration é…ç½®ç±»ï¼Œè§¦å‘äº‹ä»¶æœºåˆ¶ã€‚ï¼ˆSpring Boot ä¼š **æ³¨å†Œ Bean å¹¶è¿›è¡Œä¾èµ–æ³¨å…¥**ï¼Œå®Œæˆè‡ªåŠ¨é…ç½®ï¼ˆAutoConfigurationï¼‰å’Œç»„ä»¶æ‰«æï¼ˆComponent Scanï¼‰ï¼Œï¼‰ç¡®ä¿æ‰€æœ‰éœ€è¦çš„ Bean éƒ½å·²æ­£ç¡®åŠ è½½ã€‚åœ¨è¿™ä¹‹åï¼Œå¦‚æœæ˜¯ Web é¡¹ç›®ï¼ŒSpring Boot è¿˜ä¼š **å¯åŠ¨å†…åµŒçš„ Web æœåŠ¡å™¨**ï¼ˆå¦‚ Tomcatã€Jettyï¼‰ï¼Œå¹¶åˆå§‹åŒ– `DispatcherServlet`ï¼Œä¸ºæ¥æ”¶ HTTP è¯·æ±‚åšå¥½å‡†å¤‡ã€‚

å½“æ‰€æœ‰çš„ Bean åŠ è½½å®Œæ¯•ï¼ŒWeb æœåŠ¡å™¨ï¼ˆå¦‚æœæœ‰ï¼‰å¯åŠ¨æˆåŠŸåï¼ŒSpring Boot è¿›å…¥ **åº”ç”¨å°±ç»ªé˜¶æ®µ**ã€‚æ­¤æ—¶ï¼Œä¼šæ‰§è¡Œ **åº”ç”¨å¯åŠ¨åçš„å›è°ƒé€»è¾‘**`callRunners()`ï¼Œå³ **è¿è¡Œåœ¨ Spring å®¹å™¨åˆå§‹åŒ–å®Œæˆåéœ€è¦æ‰§è¡Œçš„é¢å¤–ä»»åŠ¡**ï¼Œæ¯”å¦‚æ•°æ®åˆå§‹åŒ–ã€ç¼“å­˜é¢„çƒ­ç­‰ã€‚Spring Boot æä¾›äº†ç‰¹å®šçš„æ¥å£ï¼ˆæ¯”å¦‚ï¼šApplicationRunnerï¼ŒCommandLineRunnerï¼‰ä¾›å¼€å‘è€…å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œç¡®ä¿åº”ç”¨åœ¨æ­£å¼å¯¹å¤–æä¾›æœåŠ¡å‰èƒ½å¤Ÿå®Œæˆå¿…è¦çš„å‡†å¤‡å·¥ä½œã€‚

æœ€åï¼ŒSpring Boot è§¦å‘ **åº”ç”¨å¯åŠ¨å®Œæˆäº‹ä»¶**ï¼Œé€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨ **åº”ç”¨å·²å‡†å¤‡å°±ç»ª**ï¼Œè‡³æ­¤ï¼Œæ•´ä¸ª Spring Boot é¡¹ç›®å¯åŠ¨æµç¨‹ç»“æŸï¼Œåº”ç”¨å¼€å§‹å¯¹å¤–æä¾›æœåŠ¡ã€‚

## Spring IOCã€AOPè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæ²¡æœ‰IOCä¹‹å‰æ€ä¹ˆåšï¼Ÿ ##

æˆ‘æƒ³å…ˆä¸€å¥è¯æ€»ç»“IOCå’ŒAOPçš„ä¼˜ç‚¹ï¼Œå°±æ˜¯ï¼š

Spring æä¾› **IOC**ï¼ˆInversion of Controlï¼š**æ§åˆ¶åè½¬**ï¼‰å’Œ **AOP**ï¼ˆAspect-Oriented Programming:**é¢å‘åˆ‡é¢ç¼–ç¨‹**ï¼‰ï¼Œå¤§å¤§æé«˜äº†ä»£ç çš„è§£è€¦æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

IOCï¼šå¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„æ§åˆ¶æƒä»å¯¹è±¡è‡ªèº«è½¬ç§»åˆ°äº†å¤–éƒ¨å®¹å™¨

AOPï¼šåˆ‡é¢ï¼ˆAspectï¼‰æ˜¯æŒ‡å°è£…äº†ä¸€ç»„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆCross-Cutting Concernï¼‰çš„æ¨¡å—ã€‚æ¢å¥è¯è¯´ï¼Œåˆ‡é¢å°±æ˜¯ä¸€æ®µä¸ä¸šåŠ¡é€»è¾‘æ— å…³ä½†åˆéœ€è¦åœ¨å¤šä¸ªåœ°æ–¹é‡å¤æ‰§è¡Œçš„ä»£ç ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å…ˆä»‹ç»æ²¡æœ‰IOCå’ŒAOPçš„æ—¶å€™ï¼Œå¦‚ä½•åšçš„ï¼Œç„¶åå¼•å‡ºæˆ‘ä»¬çš„IOCå’ŒAOPï¼Œæœ€åçªå‡ºä»–ä»¬çš„ä¼˜ç‚¹ã€‚

é¦–å…ˆï¼Œåœ¨æ²¡æœ‰IOCä¹‹å‰ï¼ŒJava ä»£ç é€šå¸¸é€šè¿‡ new å…³é”®å­— æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡ï¼Œå¹¶åœ¨æ„é€ æ–¹æ³•æˆ– setter æ–¹æ³•ä¸­æ‰‹åŠ¨ç®¡ç†ä¾èµ–ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª Java é¡¹ç›®ä¸­ï¼Œå¦‚æœä¸€ä¸ª `UserService` ç±»ä¾èµ–äº `UserDao` ç±»ï¼Œé‚£ä¹ˆåœ¨ `UserService` ç±»ä¸­éœ€è¦é€šè¿‡ `new` å…³é”®å­—æ¥åˆ›å»º `UserDao` çš„å®ä¾‹ï¼Œè¿™æ ·çš„ä»£ç å­˜åœ¨ç€ä¸¥é‡çš„è€¦åˆé—®é¢˜ï¼Œå¦‚æœéœ€è¦æ›´æ¢ `UserDao` çš„å®ç°ç±»æˆ–è€…å¯¹å…¶è¿›è¡Œä¸€äº›åˆå§‹åŒ–é…ç½®ï¼Œå°±éœ€è¦åœ¨ `UserService` ç±»ä¸­è¿›è¡Œä¿®æ”¹ï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„å¢å¤§ï¼Œç»´æŠ¤æˆæœ¬ä¼šè¶Šæ¥è¶Šé«˜ã€‚

ä½†æ˜¯ç°åœ¨æœ‰äº†IOCï¼ŒSpring é€šè¿‡ IOC å®¹å™¨ï¼ˆBeanFactory æˆ– ApplicationContextï¼‰ ç»Ÿä¸€ç®¡ç†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ï¼Œä½¿å¯¹è±¡ä¸å†ç”±ç¨‹åºå‘˜æ‰‹åŠ¨ newï¼Œè€Œæ˜¯äº¤ç»™ Spring å®¹å™¨ç®¡ç†ã€‚

æ¯”å¦‚ï¼Œä¸€ä¸ªä¸šåŠ¡é€»è¾‘ç±»å¯èƒ½ä¾èµ–äºå¤šä¸ªæ•°æ®è®¿é—®ç±»ï¼Œä½¿ç”¨ IOC åï¼Œä¸šåŠ¡é€»è¾‘ç±»ä¸éœ€è¦çŸ¥é“å…·ä½“çš„æ•°æ®è®¿é—®ç±»æ˜¯å¦‚ä½•åˆ›å»ºå’Œè·å–çš„ï¼Œåªéœ€è¦å£°æ˜å®ƒçš„ä¾èµ–å…³ç³»ï¼Œç”± Spring å®¹å™¨æ¥è´Ÿè´£æ³¨å…¥ã€‚

åŒæ—¶ï¼Œä½¿ç”¨IOCä¹Ÿå¯ä»¥æé«˜æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚å½“ä¾èµ–å…³ç³»è¢«é›†ä¸­ç®¡ç†åœ¨ Spring å®¹å™¨ä¸­æ—¶ï¼Œå¦‚æœéœ€è¦æ›´æ¢æŸä¸ªä¾èµ–å¯¹è±¡ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶æˆ–æ³¨è§£ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸éœ€è¦åœ¨å¤§é‡çš„ä¸šåŠ¡ä»£ç ä¸­è¿›è¡ŒæŸ¥æ‰¾å’Œä¿®æ”¹ã€‚åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼Œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿åœ°é€šè¿‡ IOC å®¹å™¨æ³¨å…¥æ¨¡æ‹Ÿçš„ä¾èµ–å¯¹è±¡ï¼Œæé«˜äº†æµ‹è¯•çš„çµæ´»æ€§å’Œå¯æ“ä½œæ€§ã€‚

åœ¨æ²¡æœ‰ AOP ä¹‹å‰ï¼Œå¦‚æœæƒ³åœ¨å¤šä¸ªæ–¹æ³•æ‰§è¡Œæ—¶æ·»åŠ ç›¸åŒçš„é€»è¾‘ï¼ˆä¾‹å¦‚æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ§åˆ¶ç­‰ï¼‰ï¼Œåªèƒ½ä½¿ç”¨ ç¡¬ç¼–ç  æˆ– ç»§æ‰¿ã€‚

ç”±æ­¤å°±äº§ç”Ÿäº†å¾ˆå¤šé—®é¢˜ï¼š

1. **ä»£ç é‡å¤**ï¼šæ—¥å¿—ã€äº‹åŠ¡ç­‰ä»£ç éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°æ¯ä¸ªæ–¹æ³•ï¼Œå¯¼è‡´é‡å¤ä»£ç è¿‡å¤šã€‚
2. **éš¾ä»¥ç»´æŠ¤**ï¼šå¦‚æœè¦ä¿®æ”¹æ—¥å¿—é€»è¾‘ï¼Œéœ€è¦ä¿®æ”¹æ‰€æœ‰ç›¸å…³ä»£ç ï¼Œå·¥ä½œé‡å¤§ã€‚
3. **ä¸çµæ´»**ï¼šå¦‚æœè¦ç»™æ–°æ–¹æ³•æ·»åŠ æ—¥å¿—ï¼Œå¿…é¡»æ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼Œä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰ã€‚

è€Œä½¿ç”¨**Spring AOP è§£å†³çš„é—®é¢˜**ï¼Œä¸»è¦æ˜¯å¯ä»¥**åˆ†ç¦»ä¸šåŠ¡é€»è¾‘å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚**åœ¨ä¼ä¸šçº§åº”ç”¨å¼€å‘ä¸­ï¼Œå¾€å¾€å­˜åœ¨ä¸€äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼Œè¿™äº›åŠŸèƒ½ä¼šåˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡é€»è¾‘ä»£ç ä¸­ï¼Œå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§å˜å·®ã€‚AOP å…è®¸å°†è¿™äº›æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»¥åˆ‡é¢çš„å½¢å¼è¿›è¡Œç»Ÿä¸€ç®¡ç†å’Œå®ç°ã€‚é€šè¿‡ AOPï¼Œå¯ä»¥å°†é€šç”¨çš„æ¨ªåˆ‡é€»è¾‘å°è£…åœ¨åˆ‡é¢ä¸­ï¼Œç„¶ååœ¨å¤šä¸ªä¸šåŠ¡é€»è¾‘ä¸­è¿›è¡Œå¤ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ—¥å¿—åˆ‡é¢ï¼Œåœ¨å¤šä¸ªä¸åŒçš„ä¸šåŠ¡æ–¹æ³•ä¸Šéƒ½å¯ä»¥åº”ç”¨è¿™ä¸ªåˆ‡é¢æ¥è®°å½•æ—¥å¿—ï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ä¸­éƒ½ç¼–å†™é‡å¤çš„æ—¥å¿—è®°å½•ä»£ç ã€‚

AOPè¿›è¡Œæ—¥å¿—è®°å½•ï¼š

```java
@Aspect
@Component
public class LoggingAspect {

    // å®šä¹‰åˆ‡ç‚¹ï¼ŒåŒ¹é… controller å±‚çš„æ‰€æœ‰æ–¹æ³•
    @Pointcut("execution(* com.example.controller.*.*(..))")
    public void logPointCut() {}

    // æ–¹æ³•æ‰§è¡Œå‰è®°å½•æ—¥å¿—
    @Before("logPointCut()")
    public void logBefore(JoinPoint joinPoint) {
        System.out.println("ã€æ—¥å¿—ã€‘è°ƒç”¨æ–¹æ³•ï¼š" + joinPoint.getSignature().getName());
        System.out.println("ã€æ—¥å¿—ã€‘å‚æ•°ï¼š" + Arrays.toString(joinPoint.getArgs()));
    }

    // æ–¹æ³•æ‰§è¡ŒæˆåŠŸåè®°å½•æ—¥å¿—
    @AfterReturning(value = "logPointCut()", returning = "result")
    public void logAfterReturning(JoinPoint joinPoint, Object result) {
        System.out.println("ã€æ—¥å¿—ã€‘æ–¹æ³•ï¼š" + joinPoint.getSignature().getName() + " æ‰§è¡Œå®Œæˆï¼Œè¿”å›å€¼ï¼š" + result);
    }

    // æ–¹æ³•å¼‚å¸¸æ—¶è®°å½•æ—¥å¿—
    @AfterThrowing(value = "logPointCut()", throwing = "ex")
    public void logAfterThrowing(JoinPoint joinPoint, Exception ex) {
        System.out.println("ã€æ—¥å¿—ã€‘æ–¹æ³•ï¼š" + joinPoint.getSignature().getName() + " å‘ç”Ÿå¼‚å¸¸ï¼š" + ex.getMessage());
    }
}
```

 AOP ç»Ÿä¸€ç®¡ç†äº‹åŠ¡

Spring æä¾›äº† `@Transactional` æ³¨è§£ï¼Œåº•å±‚åŸºäº AOP å®ç°äº‹åŠ¡ç®¡ç†ã€‚

```java
@Service
public class AccountService {
    
    @Autowired
    private AccountRepository accountRepository;

    @Transactional // å¯ç”¨äº‹åŠ¡
    public void transferMoney(Long fromUserId, Long toUserId, Double amount) {
        // æ‰£æ¬¾
        accountRepository.debit(fromUserId, amount);
        // æ¨¡æ‹Ÿå¼‚å¸¸
        if (amount > 1000) {
            throw new RuntimeException("å•ç¬”è½¬è´¦é‡‘é¢è¿‡å¤§ï¼Œäº¤æ˜“å¤±è´¥");
        }
        // å¢åŠ é‡‘é¢
        accountRepository.credit(toUserId, amount);
    }
}
```

 AOP æ–¹å¼å®ç°æƒé™æ§åˆ¶

```java
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.*;
import org.springframework.stereotype.Component;
import java.lang.reflect.Method;

@Aspect
@Component
public class AuthAspect {

    @Around("@annotation(com.example.security.RequiresRole)") // æ‹¦æˆªä½¿ç”¨ @RequiresRole çš„æ–¹æ³•
    public Object checkPermission(ProceedingJoinPoint joinPoint) throws Throwable {
        // è·å–å½“å‰ç”¨æˆ·è§’è‰²
        String currentUserRole = getCurrentUserRole(); 

        // è·å–æ–¹æ³•ä¸Šçš„ @RequiresRole æ³¨è§£
        Method method = ((MethodSignature) joinPoint.getSignature()).getMethod();
        RequiresRole requiresRole = method.getAnnotation(RequiresRole.class);

        // æ ¡éªŒæƒé™
        if (!currentUserRole.equals(requiresRole.value())) {
            throw new RuntimeException("ã€æƒé™ä¸è¶³ã€‘å½“å‰ç”¨æˆ·æƒé™ï¼š" + currentUserRole + "ï¼Œéœ€è¦æƒé™ï¼š" + requiresRole.value());
        }

        // æƒé™æ ¡éªŒé€šè¿‡ï¼Œæ‰§è¡Œæ–¹æ³•
        return joinPoint.proceed();
    }

    private String getCurrentUserRole() {
        // æ¨¡æ‹Ÿä»å®‰å…¨ä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·è§’è‰²ï¼ˆå®é™…é¡¹ç›®ä¸­ä» SecurityContextHolder è·å–ï¼‰
        return "USER"; // è¿™é‡Œè¿”å› USERï¼Œæ¨¡æ‹Ÿæƒé™ä¸è¶³
    }
}
```

## MySQLå»ºè¡¨çš„æ—¶å€™æœ‰å“ªäº›ä¼˜åŒ–æ‰‹æ®µï¼Ÿ ##

1. **é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹**

   ä¾‹å¦‚ï¼Œå¦‚æœå­˜å‚¨çš„æ•´æ•°èŒƒå›´åœ¨ 0 - 255 ä¹‹é—´ï¼Œä½¿ç”¨ `TINYINT` å³å¯ï¼Œè€Œä¸æ˜¯ `INT`ã€‚å› ä¸º`TINYINT` (1å­—èŠ‚) æ¯” `INT` (4å­—èŠ‚) æ›´çœç©ºé—´ã€‚å¯¹äºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `CHAR` ç±»å‹ï¼›å¯¹äºå¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `VARCHAR` ç±»å‹ã€‚

2. **åˆç†è®¾è®¡ç´¢å¼•**

   åœ¨ç»å¸¸ç”¨äº `WHERE` å­å¥ã€`JOIN` å­å¥å’Œ `ORDER BY` å­å¥çš„å­—æ®µä¸Šåˆ›å»ºç´¢å¼•ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚é¿å…åœ¨é‡å¤å€¼è¾ƒå¤šçš„å­—æ®µä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºè¿™æ ·çš„ç´¢å¼•æ•ˆæœä¸ä½³ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ€§åˆ«å­—æ®µä¸Šåˆ›å»ºç´¢å¼•å¯èƒ½æ²¡æœ‰å¤ªå¤§æ„ä¹‰ã€‚å½“ç„¶ï¼Œè¿‡å¤šçš„ç´¢å¼•ä¼šå¢åŠ å­˜å‚¨å¼€é”€å’Œå†™æ“ä½œçš„æ€§èƒ½å¼€é”€ï¼Œå› æ­¤è¦æ ¹æ®å®é™…æŸ¥è¯¢éœ€æ±‚åˆç†åˆ›å»ºç´¢å¼•ï¼Œé¿å…åˆ›å»ºè¿‡å¤šä¸å¿…è¦çš„ç´¢å¼•ã€‚

3. **æ§åˆ¶å­—æ®µæ•°é‡**

   é¿å…åˆ›å»ºè¿‡å¤šä¸å¿…è¦çš„å­—æ®µï¼Œè¿‡å¤šçš„å­—æ®µä¼šå¢åŠ è¡¨çš„å¤æ‚åº¦å’Œå­˜å‚¨å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚å¯ä»¥å°†ä¸€äº›ä¸å¸¸ç”¨çš„å­—æ®µå•ç‹¬å­˜å‚¨åœ¨å…¶ä»–è¡¨ä¸­ï¼Œé€šè¿‡å…³è”æŸ¥è¯¢è·å–æ•°æ®ã€‚

4. **éµå¾ª 3NF (ç¬¬ä¸‰èŒƒå¼)ï¼Œé€‚å½“çš„åèŒƒå¼**

   èŒƒå¼çš„åŸºæœ¬åŸåˆ™
   1NFï¼ˆç¬¬ä¸€èŒƒå¼ï¼‰ï¼šç¡®ä¿æ¯ä¸€åˆ—éƒ½æ˜¯åŸå­æ€§çš„ï¼ˆå³ä¸å¯å†æ‹†åˆ†ï¼‰ã€‚
   2NFï¼ˆç¬¬äºŒèŒƒå¼ï¼‰ï¼šç¡®ä¿éä¸»é”®å­—æ®µå®Œå…¨ä¾èµ–ä¸»é”®ï¼ˆå»é™¤éƒ¨åˆ†ä¾èµ–ï¼‰ã€‚
   3NFï¼ˆç¬¬ä¸‰èŒƒå¼ï¼‰ï¼šç¡®ä¿éä¸»é”®å­—æ®µä»…ä¾èµ–ä¸»é”®ï¼Œä¸ä¾èµ–å…¶ä»–éä¸»é”®å­—æ®µï¼ˆå»é™¤ä¼ é€’ä¾èµ–ï¼‰ã€‚

   åèŒƒå¼ï¼ˆDenormalizationï¼‰ æ˜¯åœ¨æŸ¥è¯¢æ•ˆç‡å’Œæ•°æ®å†—ä½™ä¹‹é—´åšæƒè¡¡ï¼Œæœ‰æ—¶å€™ä¸ºäº†å‡å°‘æŸ¥è¯¢æ¬¡æ•°ï¼ˆå‡å°‘ `JOIN` æ“ä½œï¼‰ï¼Œé€‚å½“å¢åŠ å†—ä½™å­—æ®µã€‚

   æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªè®¢å•ç®¡ç†çš„ä¾‹å­ï¼Œè¯¦ç»†è¯´æ˜èŒƒå¼å’ŒåèŒƒå¼ï¼š

   ```sql
   -- ç”¨æˆ·è¡¨
   CREATE TABLE users (
       user_id INT PRIMARY KEY AUTO_INCREMENT,
       username VARCHAR(50) NOT NULL,
       email VARCHAR(100) NOT NULL UNIQUE,
       address VARCHAR(255) NOT NULL
   );
   -- è®¢å•è¡¨
   CREATE TABLE orders (
       order_id INT PRIMARY KEY AUTO_INCREMENT,
       user_id INT NOT NULL,
       order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
       total_amount DECIMAL(10,2) NOT NULL,
       FOREIGN KEY (user_id) REFERENCES users(user_id)
   );
   -- CREATE TABLE order_items (
       item_id INT PRIMARY KEY AUTO_INCREMENT,
       order_id INT NOT NULL,
       product_id INT NOT NULL,
       product_name VARCHAR(100) NOT NULL,  -- è®°å½•å•†å“å
       price DECIMAL(10,2) NOT NULL,        -- å•†å“å•ä»·
       quantity INT NOT NULL,               -- è´­ä¹°æ•°é‡
       FOREIGN KEY (order_id) REFERENCES orders(order_id)
   );
   ```

   ä¼˜ç‚¹
   æ•°æ®ä¸€è‡´æ€§é«˜ï¼šç”¨æˆ·ä¿¡æ¯å’Œè®¢å•ä¿¡æ¯åˆ†ç¦»ï¼Œå¦‚æœç”¨æˆ·ä¿®æ”¹åœ°å€ï¼Œè®¢å•ä¸ä¼šå—åˆ°å½±å“ã€‚
   èŠ‚çœå­˜å‚¨ç©ºé—´ï¼šé¿å…é‡å¤å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå¤šä¸ªè®¢å•éƒ½å¯ä»¥å¼•ç”¨ users è¡¨ä¸­çš„æ•°æ®ã€‚

   ç¼ºç‚¹

   æŸ¥è¯¢å¤æ‚ï¼šæŸ¥è¯¢è®¢å•è¯¦æƒ…æ—¶éœ€è¦ JOIN å¤šä¸ªè¡¨ï¼Œå½±å“æ€§èƒ½ã€‚
   ä¾‹å¦‚æŸ¥è¯¢æŸä¸ªè®¢å•çš„ä¿¡æ¯ï¼š

   ```sql
   SELECT o.order_id, u.username, u.address, o.total_amount, oi.product_name, oi.price, oi.quantity
   FROM orders o
   JOIN users u ON o.user_id = u.user_id
   JOIN order_items oi ON o.order_id = oi.order_id
   WHERE o.order_id = 123;
   ```

   éœ€è¦ `JOIN` ä¸‰å¼ è¡¨ï¼ŒæŸ¥è¯¢è¾ƒæ…¢ã€‚

   é‡‡ç”¨åèŒƒå¼ä¼˜åŒ–:

   ä¼˜åŒ–åçš„è¡¨ç»“æ„
   è®¢å•è¡¨ï¼ˆOrdersï¼‰â€”â€” å†—ä½™å­˜å‚¨ç”¨æˆ·åå’Œåœ°å€

   ```sql
   CREATE TABLE orders (
       order_id INT PRIMARY KEY AUTO_INCREMENT,
       user_id INT NOT NULL,
       username VARCHAR(50) NOT NULL,  -- å†—ä½™å­—æ®µ
       address VARCHAR(255) NOT NULL,  -- å†—ä½™å­—æ®µ
       order_date DATETIME DEFAULT CURRENT_TIMESTAMP,
       total_amount DECIMAL(10,2) NOT NULL
   );
   ```

   username å’Œ address ç›´æ¥å­˜å…¥ ordersï¼Œè¿™æ ·æŸ¥è¯¢è®¢å•æ—¶ä¸éœ€è¦å† JOIN usersï¼ŒæŸ¥è¯¢æ›´å¿«ã€‚
   åŸæœ¬éœ€è¦ JOIN users çš„æŸ¥è¯¢ï¼š

   ```sql
   SELECT o.order_id, u.username, u.address, o.total_amount
   FROM orders o
   JOIN users u ON o.user_id = u.user_id
   WHERE o.order_id = 123;
   ```

   ç°åœ¨åªéœ€è¦æŸ¥ orders è¡¨ï¼š

   ```sql
   SELECT order_id, username, address, total_amount
   FROM orders
   WHERE order_id = 123;
   ```

   âœ… æŸ¥è¯¢æ›´å¿«ï¼Œå°‘äº†ä¸€æ¬¡ JOIN æ“ä½œã€‚

   âœ… ä¼˜ç‚¹

   æŸ¥è¯¢æ›´å¿«ï¼šå‡å°‘ JOINï¼Œå°¤å…¶åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸‹ï¼Œæ€§èƒ½æå‡æ˜æ˜¾ã€‚
   é€‚ç”¨äºæŸ¥è¯¢å¤šã€å†™å…¥å°‘çš„åœºæ™¯ï¼šå¦‚æœè®¢å•æ•°æ®æ˜¯åªè¯»çš„ï¼ˆä¸ä¼šä¿®æ”¹ï¼‰ï¼Œå†—ä½™å­—æ®µä¸ä¼šå¸¦æ¥å¤ªå¤§é—®é¢˜ã€‚
   âŒ ç¼ºç‚¹

   æ•°æ®å†—ä½™ï¼šusername å’Œ address å­˜åœ¨å¤šä¸ª orders è®°å½•ä¸­ï¼Œå ç”¨é¢å¤–å­˜å‚¨ç©ºé—´ã€‚
   æ›´æ–°ä»£ä»·é«˜ï¼šå¦‚æœç”¨æˆ·ä¿®æ”¹åœ°å€ï¼Œéœ€è¦æ›´æ–° orders è¡¨ä¸­æ‰€æœ‰ç›¸å…³è®°å½•ï¼Œå¦åˆ™å†å²è®¢å•ä¸­çš„åœ°å€å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚

## MySQLç´¢å¼•æ€ä¹ˆå»ºï¼Ÿ ##

ï¼ˆ1ï¼‰æ™®é€šç´¢å¼•ï¼ˆNormal Indexï¼‰

```sql
-- åœ¨åˆ›å»ºè¡¨æ—¶åˆ›å»ºæ™®é€šç´¢å¼•
CREATE TABLEÂ table_nameÂ (
Â  Â  column1 datatype,
Â  Â  column2 datatype,
Â  Â  ...
Â  Â  INDEX index_name (column1, column2, ...)
);

-- åœ¨å·²å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºæ™®é€šç´¢å¼•
CREATE INDEX index_name ONÂ table_nameÂ (column1, column2, ...);

-- ä½¿ç”¨ ALTER TABLE è¯­å¥åˆ›å»ºæ™®é€šç´¢å¼•
ALTER TABLE table_name ADD INDEXÂ index_nameÂ (column1, column2, ...);
```

ï¼ˆ2ï¼‰å”¯ä¸€ç´¢å¼•ï¼ˆUnique Indexï¼‰

å”¯ä¸€ç´¢å¼•è¦æ±‚ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚

```sql
-- åœ¨åˆ›å»ºè¡¨æ—¶åˆ›å»ºå”¯ä¸€ç´¢å¼•
CREATE TABLEÂ table_nameÂ (
Â  Â  column1 datatype,
Â  Â  column2 datatype,
Â  Â  ...
Â  Â  UNIQUE INDEX index_name (column1, column2, ...)
);

-- åœ¨å·²å­˜åœ¨çš„è¡¨ä¸Šåˆ›å»ºå”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX index_name ONÂ table_nameÂ (column1, column2, ...);

-- ä½¿ç”¨ ALTER TABLE è¯­å¥åˆ›å»ºå”¯ä¸€ç´¢å¼•
ALTER TABLE table_name ADD UNIQUE INDEXÂ index_nameÂ (column1, column2, ...);
```

ï¼ˆ3ï¼‰ä¸»é”®ç´¢å¼•ï¼ˆPrimary Key Indexï¼‰

ä¸»é”®ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œå®ƒä¸å…è®¸æœ‰ç©ºå€¼ã€‚é€šå¸¸åœ¨åˆ›å»ºè¡¨æ—¶æŒ‡å®šä¸»é”®ï¼ŒMySQL ä¼šè‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•ã€‚

```sql
-- åœ¨åˆ›å»ºè¡¨æ—¶åˆ›å»ºä¸»é”®ç´¢å¼•
CREATE TABLEÂ table_nameÂ (
Â  Â  column1 datatype PRIMARY KEY,
Â  Â  column2 datatype,
Â  Â  ...
);

-- ä½¿ç”¨ ALTER TABLE è¯­å¥åˆ›å»ºä¸»é”®ç´¢å¼•
ALTER TABLE table_name ADD PRIMARYÂ KEYÂ (column1, column2, ...);
```

**æ™®é€šç´¢å¼•**ï¼šåŠ é€ŸæŸ¥è¯¢ã€‚

**å”¯ä¸€ç´¢å¼•**ï¼šä¿è¯æ•°æ®å”¯ä¸€æ€§ã€‚

**ä¸»é”®ç´¢å¼•**ï¼šå”¯ä¸€ä¸” `NOT NULL`ï¼Œç”¨äºä¸»é”®ã€‚

## æœ€ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ ##

å¸¸è§çš„è®¾è®¡æ¨¡å¼ä¸»è¦åŒ…æ‹¬ **å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼** ç­‰

### å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ ###

ç¡®ä¿ä¸€ä¸ªç±»åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¯¥å®ä¾‹ã€‚

####  é¥¿æ±‰å¼(Eager Initializationï¼‰ ####

ç‰¹ç‚¹ï¼š

- åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ã€‚
- é€‚ç”¨äºå¯åŠ¨æ—¶å³éœ€è¦ä½¿ç”¨çš„å•ä¾‹å¯¹è±¡ã€‚

```java
public class Singleton {
    private static final Singleton INSTANCE = new Singleton(); // æå‰åˆ›å»ºå®ä¾‹

    private Singleton() {} // ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–

    public static Singleton getInstance() {
        return INSTANCE;
    }
}
```

ä¼˜ç¼ºç‚¹ï¼š 

âœ… çº¿ç¨‹å®‰å…¨ï¼Œè°ƒç”¨æ—¶ä¸éœ€è¦åŒæ­¥ã€‚
âŒ å¯èƒ½ä¼šæµªè´¹å†…å­˜ï¼ˆå¦‚æœå®ä¾‹åœ¨é¡¹ç›®ç”Ÿå‘½å‘¨æœŸä¸­æœªè¢«ä½¿ç”¨ï¼‰ã€‚

#### æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼‰ ####

ç‰¹ç‚¹ï¼š

- åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ `getInstance()` æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼ŒèŠ‚çœèµ„æºã€‚
- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆå¯èƒ½å¯¼è‡´å¤šä¸ªå®ä¾‹è¢«åˆ›å»ºï¼‰ã€‚

```java
public class Singleton {
    private static Singleton instance; // åˆå§‹ä¸º null

    private Singleton() {} // ç§æœ‰æ„é€ æ–¹æ³•

    public static Singleton getInstance() {
        if (instance == null) {  // ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºå®ä¾‹
            instance = new Singleton();
        }
        return instance;
    }
}
```

#### çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å¼ï¼ˆSynchronized æ–¹å¼ï¼‰ ####

ç‰¹ç‚¹ï¼š

- é€šè¿‡ `synchronized` ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚
- æ€§èƒ½è¾ƒä½ï¼ˆæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦åŒæ­¥ï¼Œå½±å“æ•ˆç‡ï¼‰ã€‚

```java
public class Singleton {
    private static Singleton instance;

    private Singleton() {}

    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

ä¸ºä»€ä¹ˆ `synchronized` å…³é”®å­—èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ

`synchronized` å…³é”®å­—çš„ä½œç”¨æ˜¯åŠ é”ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¢« `synchronized` ä¿®é¥°çš„ä»£ç å—æˆ–æ–¹æ³•ã€‚

è¿™æ˜¯é€šè¿‡å†…ç½®çš„ç›‘è§†å™¨é”ï¼ˆMonitor Lockï¼‰å®ç°çš„ã€‚

å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ getInstance()ï¼š

1. ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œå‘ç° instance == nullï¼Œæ‰§è¡Œ new Singleton() åˆ›å»ºå®ä¾‹ã€‚

2. ç¬¬äºŒä¸ªçº¿ç¨‹æƒ³è¿›å…¥æ–¹æ³•ï¼Œä½† synchronized è®©å®ƒå¿…é¡»ç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œï¼Œç¡®ä¿ä¸ä¼šåŒæ—¶åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚

3. ç¬¬ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå®Œæˆåï¼Œé€€å‡ºæ–¹æ³•ï¼Œé‡Šæ”¾é”ã€‚

4. ç¬¬äºŒä¸ªçº¿ç¨‹è·å–é”ï¼Œå‘ç° instance != nullï¼Œç›´æ¥è¿”å›å·²åˆ›å»ºçš„å®ä¾‹ã€‚

   è¿™æ ·å°±ä¿è¯äº†å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå¤šä¸ªå®ä¾‹çš„é—®é¢˜ã€‚

#### åŒé‡æ£€æŸ¥é”ï¼ˆDCL, Double-Checked Lockingï¼‰ ####

ç‰¹ç‚¹ï¼š

- ç»“åˆæ‡’æ±‰å¼çš„å»¶è¿ŸåŠ è½½å’Œçº¿ç¨‹å®‰å…¨ã€‚
- é€‚ç”¨äºé«˜å¹¶å‘ç¯å¢ƒã€‚

```java
public class Singleton {
    private static volatile Singleton instance; // volatile é˜²æ­¢æŒ‡ä»¤é‡æ’åº

    private Singleton() {}

    public static Singleton getInstance() {
        if (instance == null) {  // ç¬¬ä¸€æ¬¡æ£€æŸ¥
            synchronized (Singleton.class) {
                if (instance == null) {  // ç¬¬äºŒæ¬¡æ£€æŸ¥
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```

ä¼˜ç¼ºç‚¹ï¼š

 âœ… çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½è¾ƒå¥½ï¼ˆåªåœ¨å®ä¾‹æœªåˆ›å»ºæ—¶æ‰åŠ é”ï¼‰ã€‚
 âœ… é¿å…äº† synchronized æ–¹å¼çš„æ•ˆç‡é—®é¢˜ã€‚
 âŒ ä»£ç è¾ƒå¤æ‚ã€‚

ä¸ºä»€ä¹ˆéœ€è¦ `volatile`ï¼Ÿ

- `new Singleton()` ä¸æ˜¯åŸå­æ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åºï¼Œå¯¼è‡´çº¿ç¨‹è·å–åˆ°æœªåˆå§‹åŒ–å®Œå…¨çš„å®ä¾‹ã€‚
- `volatile` å…³é”®å­—å¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿å¯¹è±¡å®Œå…¨åˆå§‹åŒ–åå†åˆ†é…ç»™ `instance`ã€‚

æŒ‡ä»¤é‡æ’åºï¼ˆInstruction Reorderingï¼‰ æ˜¯æŒ‡CPU æˆ–ç¼–è¯‘å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œåœ¨ä¸å½±å“å•çº¿ç¨‹æœ€ç»ˆæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå¯¹æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºè¿›è¡Œè°ƒæ•´ã€‚

ğŸš€ ç®€å•æ¥è¯´ï¼ŒæŒ‡ä»¤é‡æ’åºæ˜¯ä¸ºäº†è®©ç¨‹åºè¿è¡Œå¾—æ›´å¿«ï¼Œä½†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼

åŒé‡æ£€æŸ¥é”çš„åŸç†ï¼š

1. ç¬¬ä¸€æ¬¡æ£€æŸ¥ `instance == null`ï¼ˆä¸åŠ é”ï¼Œæé«˜æ€§èƒ½ï¼‰ã€‚
2. å¦‚æœ `instance == null`ï¼Œæ‰è¿›å…¥ `synchronized` ä»£ç å—ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå®ä¾‹ã€‚
3. ç¬¬äºŒæ¬¡æ£€æŸ¥ `instance == null`ï¼ˆä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå®ä¾‹ï¼‰ã€‚
4. åˆ›å»º `Singleton` å®ä¾‹ã€‚

####  é™æ€å†…éƒ¨ç±»ï¼ˆæ¨èæ–¹å¼ï¼‰ ####

ç‰¹ç‚¹ï¼š

- çº¿ç¨‹å®‰å…¨ï¼ŒåŸºäº JVM ç±»åŠ è½½æœºåˆ¶ï¼Œé¿å…äº†åŒæ­¥é—®é¢˜ã€‚
- åªæœ‰åœ¨è°ƒç”¨ getInstance() æ—¶æ‰ä¼šåŠ è½½å†…éƒ¨ç±»ï¼Œå®Œæˆå®ä¾‹åŒ–ï¼Œå®ç°æ‡’åŠ è½½ã€‚
- æ¨èä½¿ç”¨æ–¹å¼ã€‚

```java
public class Singleton {
    private Singleton() {}

    private static class SingletonHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    public static Singleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}
```

åŸç†ï¼š

- `SingletonHolder` æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œä¸ä¼šåœ¨ `Singleton` ç±»åŠ è½½æ—¶ç«‹å³åˆ›å»ºã€‚
- åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ `getInstance()` æ—¶ï¼ŒJVM æ‰ä¼šåŠ è½½ `SingletonHolder` å¹¶åˆ›å»ºå®ä¾‹ï¼Œä¿è¯äº†å»¶è¿ŸåŠ è½½ã€‚

####  æšä¸¾å•ä¾‹ï¼ˆæœ€å®‰å…¨çš„æ–¹å¼ï¼‰ ####

```java
public enum Singleton {
    INSTANCE;

    public void doSomething() {
        System.out.println("Hello Singleton");
    }
}
```

ä¼˜ç¼ºç‚¹ï¼š 

âœ… æœ€ç®€å•ã€æœ€å®‰å…¨ï¼Œé¿å…äº†æ‰€æœ‰å•ä¾‹æ¨¡å¼å¯èƒ½çš„å®‰å…¨é—®é¢˜ã€‚
âœ… é˜²æ­¢åå°„ç ´åã€ååºåˆ—åŒ–ç ´åã€‚
âŒ ä¸æ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆæšä¸¾åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼‰ã€‚
âŒ ä¸é€‚ç”¨äºéœ€è¦ç»§æ‰¿çš„åœºæ™¯ï¼ˆæšä¸¾ä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ï¼‰ã€‚

å•ä¾‹æ¨¡å¼åœ¨ Java **é¡¹ç›®ä¸­çš„ä½¿ç”¨åœºæ™¯**

1. æ•°æ®åº“è¿æ¥æ± 
   - ä¾‹å¦‚ `HikariCP`ã€`Druid`ï¼Œä½¿ç”¨å•ä¾‹ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œæé«˜æ•ˆç‡ã€‚
2. Spring Bean
   - Spring é»˜è®¤çš„ Bean ä½œç”¨åŸŸæ˜¯å•ä¾‹æ¨¡å¼ï¼ˆ`@Scope("singleton")`ï¼‰ã€‚
3. çº¿ç¨‹æ± 
   - çº¿ç¨‹æ± å¯¹è±¡åº”å…¨å±€å”¯ä¸€ï¼Œé¿å…é‡å¤åˆ›å»ºæµªè´¹èµ„æºã€‚
4. é…ç½®ç®¡ç†
   - ä¾‹å¦‚ `Properties` è¯»å–åº”ç”¨é…ç½®ï¼Œç¡®ä¿é…ç½®ç»Ÿä¸€ã€‚
5. æ—¥å¿—ç®¡ç†
   - `Log4j`ã€`SLF4J` ç­‰æ—¥å¿—æ¡†æ¶é€šå¸¸ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚
6. ç¼“å­˜ç®¡ç†
   - æœ¬åœ°ç¼“å­˜å¦‚ `Guava Cache`ï¼Œä¿è¯æ•°æ®å­˜å‚¨å”¯ä¸€ã€‚

**æ€»ç»“**

| æ–¹å¼         | çº¿ç¨‹å®‰å…¨ | æ˜¯å¦å»¶è¿ŸåŠ è½½ | æ˜¯å¦æ¨è          |
| ------------ | -------- | ------------ | ----------------- |
| é¥¿æ±‰å¼       | âœ…        | âŒ            | âŒï¼ˆå¯èƒ½æµªè´¹èµ„æºï¼‰ |
| æ‡’æ±‰å¼       | âŒ        | âœ…            | âŒï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰   |
| synchronized | âœ…        | âœ…            | âŒï¼ˆæ€§èƒ½ä½ï¼‰       |
| åŒé‡æ£€æŸ¥é”   | âœ…        | âœ…            | âœ…ï¼ˆé€‚ç”¨äºé«˜å¹¶å‘ï¼‰ |
| é™æ€å†…éƒ¨ç±»   | âœ…        | âœ…            | âœ…ï¼ˆæ¨èï¼‰         |
| æšä¸¾         | âœ…        | âŒ            | âœ…ï¼ˆæœ€å®‰å…¨ï¼‰       |

é¥¿æ±‰å¼ä½“ç°åœ¨â€œé¥¿â€ï¼Œä¹Ÿå°±æ˜¯ç±»åŠ è½½çš„æ—¶å€™å°±åˆ›å»ºå®ä¾‹ï¼Œä¸ç®¡ä½ åæœŸç”¨ä¸ç”¨ï¼Œè€Œæ‡’æ±‰å¼ä½“ç°åœ¨â€œæ‡’â€ï¼Œä½ ä¸ç”¨æˆ‘ï¼Œæˆ‘å°±ä¸åˆ›å»ºå®ä¾‹ã€‚

### å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰ ###

å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•ä½¿ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚

```java
// é€šçŸ¥æ¥å£
public interface Notification {
    void send(String message);
}

// å…·ä½“å®ç°ç±»
public class EmailNotification implements Notification {
    @Override
    public void send(String message) {
        System.out.println("å‘é€é‚®ä»¶ï¼š" + message);
    }
}

public class SmsNotification implements Notification {
    @Override
    public void send(String message) {
        System.out.println("å‘é€çŸ­ä¿¡ï¼š" + message);
    }
}

// å·¥å‚ç±»
public class NotificationFactory {
    public static Notification createNotification(String type) {
        if ("email".equalsIgnoreCase(type)) {
            return new EmailNotification();
        } else if ("sms".equalsIgnoreCase(type)) {
            return new SmsNotification();
        }
        throw new IllegalArgumentException("æœªçŸ¥é€šçŸ¥ç±»å‹ï¼š" + type);
    }
}

// ä½¿ç”¨å·¥å‚
@RestController
@RequestMapping("/factory")
public class FactoryController {
    @GetMapping("/send")
    public String sendNotification(@RequestParam String type, @RequestParam String message) {
        Notification notification = NotificationFactory.createNotification(type);
        notification.send(message);
        return "æ¶ˆæ¯å·²å‘é€";
    }
}
```

### ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰ ###

AOPï¼ˆAspect-Oriented Programmingï¼‰ æœ¬è´¨ä¸Šå°±æ˜¯ ä»£ç†æ¨¡å¼ï¼Œç”¨äºæ‹¦æˆªæ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ æ—¥å¿—ã€æƒé™éªŒè¯ã€äº‹åŠ¡å¤„ç† ç­‰ã€‚

```java
@Aspect
@Component
public class LoggingAspect {
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceMethods() {}

    @Before("serviceMethods()")
    public void logBeforeMethod(JoinPoint joinPoint) {
        System.out.println("è°ƒç”¨æ–¹æ³•ï¼š" + joinPoint.getSignature().getName());
    }
}
```

å…è®¸é€šè¿‡ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰æ¥æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡ï¼ˆReal Subjectï¼‰çš„è®¿é—®ã€‚ä»£ç†å¯¹è±¡å¯ä»¥åœ¨ä¸æ”¹å˜ç›®æ ‡å¯¹è±¡åŠŸèƒ½çš„å‰æä¸‹ï¼Œæ·»åŠ é¢å¤–çš„é€»è¾‘ï¼Œå¦‚æƒé™æ§åˆ¶ã€å»¶è¿ŸåŠ è½½ã€æ—¥å¿—è®°å½•ç­‰ã€‚

#### é™æ€ä»£ç† ####

é™æ€ä»£ç†éœ€è¦æ‰‹åŠ¨åˆ›å»ºä»£ç†ç±»ï¼Œå®ç°ä¸ç›®æ ‡ç±»ç›¸åŒçš„æ¥å£ã€‚

ä¸¾ä¾‹ï¼š

å‡è®¾æœ‰ä¸€ä¸ª `UserService`ï¼Œå®ƒæä¾›ç”¨æˆ·ç™»å½•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è°ƒç”¨ `login` æ–¹æ³•æ—¶æ‰“å°æ—¥å¿—ã€‚

```java
// 1. å®šä¹‰æ¥å£
public interface UserService {
    void login(String username, String password);
}

// 2. å®ç°ç›®æ ‡å¯¹è±¡
public class UserServiceImpl implements UserService {
    @Override
    public void login(String username, String password) {
        System.out.println(username + " ç™»å½•æˆåŠŸï¼");
    }
}

// 3. åˆ›å»ºä»£ç†ç±»
public class UserServiceProxy implements UserService {
    private final UserService userService;

    public UserServiceProxy(UserService userService) {
        this.userService = userService;
    }

    @Override
    public void login(String username, String password) {
        System.out.println("æ—¥å¿—ï¼šç”¨æˆ·å°è¯•ç™»å½•...");
        userService.login(username, password);
        System.out.println("æ—¥å¿—ï¼šç™»å½•æ“ä½œå®Œæˆï¼");
    }
}

// 4. æµ‹è¯•ä»£ç†æ¨¡å¼
public class ProxyPatternDemo {
    public static void main(String[] args) {
        UserService userService = new UserServiceProxy(new UserServiceImpl());
        userService.login("Alice", "123456");
    }
}
```

â€‹	ç¼ºç‚¹ï¼š

- éœ€è¦æ‰‹åŠ¨åˆ›å»ºä»£ç†ç±»ï¼Œä»£ç é‡å¤ï¼Œä¸å¤Ÿçµæ´»ã€‚
- æ¯å¢åŠ ä¸€ä¸ªæ–°çš„æ¥å£æ–¹æ³•ï¼Œéƒ½è¦ä¿®æ”¹ä»£ç†ç±»ã€‚

#### åŠ¨æ€ä»£ç† ####

åŠ¨æ€ä»£ç†å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œé¿å…æ‰‹å†™ä»£ç†ç±»çš„ç¹çã€‚

JDK åŠ¨æ€ä»£ç†

JDK åŠ¨æ€ä»£ç†ä½¿ç”¨ `java.lang.reflect.Proxy` ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè¦æ±‚ç›®æ ‡å¯¹è±¡å®ç°æ¥å£ã€‚

```java
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

// 1. åˆ›å»ºåŠ¨æ€ä»£ç†ç±»
class UserServiceInvocationHandler implements InvocationHandler {
    private final Object target;

    public UserServiceInvocationHandler(Object target) {
        this.target = target;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        System.out.println("æ—¥å¿—ï¼šè°ƒç”¨æ–¹æ³• " + method.getName());
        Object result = method.invoke(target, args);
        System.out.println("æ—¥å¿—ï¼šæ–¹æ³•æ‰§è¡Œå®Œæˆ");
        return result;
    }
}

// 2. ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†
public class DynamicProxyDemo {
    public static void main(String[] args) {
        UserService target = new UserServiceImpl();
        UserService proxy = (UserService) Proxy.newProxyInstance(
                target.getClass().getClassLoader(),
                target.getClass().getInterfaces(),
                new UserServiceInvocationHandler(target)
        );
        proxy.login("Bob", "password123");
    }
}
```

**CGLIB åŠ¨æ€ä»£ç†**

CGLIBï¼ˆCode Generation Libraryï¼‰å¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼Œä½¿ç”¨ ASM ç”Ÿæˆå­—èŠ‚ç ã€‚

```java
import net.sf.cglib.proxy.Enhancer;
import net.sf.cglib.proxy.MethodInterceptor;
import net.sf.cglib.proxy.MethodProxy;
import java.lang.reflect.Method;

// 1. åˆ›å»º CGLIB ä»£ç†
class CglibProxy implements MethodInterceptor {
    private final Object target;

    public CglibProxy(Object target) {
        this.target = target;
    }

    public Object getProxy() {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(this);
        return enhancer.create();
    }

    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("æ—¥å¿—ï¼šè°ƒç”¨æ–¹æ³• " + method.getName());
        Object result = proxy.invokeSuper(obj, args);
        System.out.println("æ—¥å¿—ï¼šæ–¹æ³•æ‰§è¡Œå®Œæˆ");
        return result;
    }
}

// 2. ä½¿ç”¨ CGLIB ä»£ç†
public class CglibProxyDemo {
    public static void main(String[] args) {
        UserServiceImpl target = new UserServiceImpl();
        UserServiceImpl proxy = (UserServiceImpl) new CglibProxy(target).getProxy();
        proxy.login("Charlie", "qwerty");
    }
}
```

- Spring AOP é»˜è®¤ä½¿ç”¨ **JDK ä»£ç†**ï¼Œä½†å¦‚æœç±»æ²¡æœ‰æ¥å£ï¼ŒSpring è‡ªåŠ¨åˆ‡æ¢åˆ° **CGLIB ä»£ç†**

### ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰ ###

å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚è¯¥æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚

```java
// å®šä¹‰æ”¯ä»˜ç­–ç•¥æ¥å£
public interface PaymentStrategy {
    void pay(int amount);
}

// å…·ä½“æ”¯ä»˜æ–¹å¼
@Component
public class WeChatPay implements PaymentStrategy {
    @Override
    public void pay(int amount) {
        System.out.println("ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ï¼š" + amount + " å…ƒ");
    }
}

@Component
public class AliPay implements PaymentStrategy {
    @Override
    public void pay(int amount) {
        System.out.println("ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼š" + amount + " å…ƒ");
    }
}

// æ”¯ä»˜ç­–ç•¥å·¥å‚
@Component
public class PaymentStrategyFactory {
    private final Map<String, PaymentStrategy> strategyMap;

    @Autowired
    public PaymentStrategyFactory(List<PaymentStrategy> strategies) {
        strategyMap = new HashMap<>();
        for (PaymentStrategy strategy : strategies) {
            strategyMap.put(strategy.getClass().getSimpleName(), strategy);
        }
    }

    public PaymentStrategy getStrategy(String type) {
        return strategyMap.getOrDefault(type, new AliPay());
    }
}

// ä½¿ç”¨ç­–ç•¥æ¨¡å¼
@RestController
@RequestMapping("/pay")
public class PaymentController {
    @Autowired
    private PaymentStrategyFactory paymentStrategyFactory;

    @GetMapping("/do")
    public String pay(@RequestParam String type, @RequestParam int amount) {
        PaymentStrategy strategy = paymentStrategyFactory.getStrategy(type);
        strategy.pay(amount);
        return "æ”¯ä»˜æˆåŠŸ";
    }
}
```

### æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰ ###

é€‚ç”¨äº å¤šä¸ªç±»æœ‰ç›¸ä¼¼çš„ä¸šåŠ¡æµç¨‹ï¼Œä½†æŸäº›æ­¥éª¤å¯ä»¥ç”±å­ç±»å®ç°ã€‚

```java
public abstract class FileImporter {
    // æ¨¡æ¿æ–¹æ³•
    public final void importFile(String fileName) {
        openFile(fileName);
        parseData();
        saveData();
        closeFile();
    }

    protected abstract void openFile(String fileName);
    protected abstract void parseData();
    protected abstract void saveData();

    protected void closeFile() {
        System.out.println("å…³é—­æ–‡ä»¶");
    }
}

// å…·ä½“å®ç°ç±»
@Component
public class ExcelFileImporter extends FileImporter {
    @Override
    protected void openFile(String fileName) {
        System.out.println("æ‰“å¼€ Excel æ–‡ä»¶ï¼š" + fileName);
    }

    @Override
    protected void parseData() {
        System.out.println("è§£æ Excel æ•°æ®");
    }

    @Override
    protected void saveData() {
        System.out.println("ä¿å­˜ Excel æ•°æ®åˆ°æ•°æ®åº“");
    }
}

// ä½¿ç”¨æ¨¡æ¿æ–¹æ³•
@RestController
@RequestMapping("/import")
public class ImportController {
    @Autowired
    private ExcelFileImporter excelFileImporter;

    @GetMapping("/excel")
    public String importExcel(@RequestParam String fileName) {
        excelFileImporter.importFile(fileName);
        return "å¯¼å…¥å®Œæˆ";
    }
}
```

### è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰ ###

Spring äº‹ä»¶æœºåˆ¶ å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼Œé€‚ç”¨äºå‘å¸ƒ-è®¢é˜…åœºæ™¯ã€‚

ç”¨æˆ·æ³¨å†Œåå‘é€é€šçŸ¥ï¼š

```java
// å®šä¹‰äº‹ä»¶
public class UserRegisteredEvent extends ApplicationEvent {
    private final String username;

    public UserRegisteredEvent(Object source, String username) {
        super(source);
        this.username = username;
    }

    public String getUsername() {
        return username;
    }
}

// äº‹ä»¶ç›‘å¬å™¨
@Component
public class UserRegisteredListener {
    @EventListener
    public void handleUserRegistered(UserRegisteredEvent event) {
        System.out.println("ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œå‘é€æ¬¢è¿é‚®ä»¶ï¼š" + event.getUsername());
    }
}

// è§¦å‘äº‹ä»¶
@RestController
@RequestMapping("/user")
public class UserController {
    @Autowired
    private ApplicationEventPublisher eventPublisher;

    @PostMapping("/register")
    public String registerUser(@RequestParam String username) {
        eventPublisher.publishEvent(new UserRegisteredEvent(this, username));
        return "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ";
    }
}
```

### è£…é¥°å™¨æ¨¡å¼ ###

è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸€ç§ ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºåœ¨**ä¸ä¿®æ”¹åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹åŠ¨æ€åœ°ç»™å¯¹è±¡å¢åŠ æ–°çš„åŠŸèƒ½**ã€‚å®ƒé€šè¿‡å°†å¯¹è±¡åŒ…è£…åœ¨è£…é¥°å™¨ç±»ä¸­ï¼Œä»è€Œå¢å¼ºå…¶åŠŸèƒ½ï¼ŒåŒæ—¶ä»ç„¶ä¿æŒåŸå¯¹è±¡çš„æ¥å£ã€‚

è£…é¥°å™¨æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†è¡Œä¸ºé™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿æ¥æ‰©å±•åŠŸèƒ½ã€‚è¿™æ ·å¯ä»¥çµæ´»åœ°ç»„åˆä¸åŒçš„åŠŸèƒ½ï¼Œé¿å…åˆ›å»ºå¤§é‡å­ç±»ã€‚

è£…é¥°å™¨æ¨¡å¼ä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

- **æŠ½è±¡ç»„ä»¶**ï¼ˆComponentï¼‰ï¼šå®šä¹‰å¯¹è±¡çš„åŸºæœ¬æ¥å£ï¼Œè£…é¥°å™¨å’Œå…·ä½“ç»„ä»¶éƒ½è¦å®ç°è¿™ä¸ªæ¥å£ã€‚
- **å…·ä½“ç»„ä»¶**ï¼ˆConcrete Componentï¼‰ï¼šå®ç° `Component` æ¥å£çš„åŸºæœ¬å¯¹è±¡ï¼Œè£…é¥°å™¨å°†åŒ…è£…è¿™ä¸ªå¯¹è±¡ã€‚
- **æŠ½è±¡è£…é¥°å™¨**ï¼ˆDecoratorï¼‰ï¼šæŒæœ‰ä¸€ä¸ª `Component` å¯¹è±¡ï¼Œå¹¶å®ç° `Component` æ¥å£ï¼Œä½†æœ¬èº«ä¸ä¼šæ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œè€Œæ˜¯è®©å­ç±»å®ç°å…·ä½“çš„å¢å¼ºåŠŸèƒ½ã€‚
- **å…·ä½“è£…é¥°å™¨**ï¼ˆConcrete Decoratorï¼‰ï¼šç»§æ‰¿ `Decorator`ï¼Œæ‰©å±• `Component` çš„åŠŸèƒ½ã€‚

ç¤ºä¾‹ï¼šç»™å’–å•¡æ·»åŠ ä¸åŒçš„é…æ–™

éœ€æ±‚ï¼š

 æˆ‘ä»¬æœ‰ä¸€ä¸ªåŸºç¡€çš„å’–å•¡ `Coffee`ï¼Œç„¶åå¯ä»¥**åŠ¨æ€æ·»åŠ ä¸åŒçš„é…æ–™ï¼ˆå¦‚ç‰›å¥¶ã€ç³–ï¼‰**ï¼Œè€Œä¸ä¼šä¿®æ”¹ `Coffee` çš„ä»£ç ã€‚

(1) å®šä¹‰æŠ½è±¡ç»„ä»¶

```java
// æŠ½è±¡ç»„ä»¶ï¼šå’–å•¡
public interface Coffee {
    String getDescription();  // è·å–æè¿°
    double getCost();         // è·å–ä»·æ ¼
}
```

(2) å…·ä½“ç»„ä»¶

```java
// å…·ä½“ç»„ä»¶ï¼šåŸºç¡€å’–å•¡
public class SimpleCoffee implements Coffee {
    @Override
    public String getDescription() {
        return "æ™®é€šå’–å•¡";
    }

    @Override
    public double getCost() {
        return 10.0; // åŸºç¡€å’–å•¡ä»·æ ¼
    }
}
```

(3) å®šä¹‰è£…é¥°å™¨åŸºç±»

```java
// æŠ½è±¡è£…é¥°å™¨ï¼šå’–å•¡è£…é¥°å™¨
public abstract class CoffeeDecorator implements Coffee {
    protected Coffee decoratedCoffee; // ç»´æŠ¤ä¸€ä¸ªè¢«è£…é¥°çš„å¯¹è±¡

    public CoffeeDecorator(Coffee coffee) {
        this.decoratedCoffee = coffee;
    }

    @Override
    public String getDescription() {
        return decoratedCoffee.getDescription(); // é»˜è®¤è¿”å›åŸå§‹æè¿°
    }

    @Override
    public double getCost() {
        return decoratedCoffee.getCost(); // é»˜è®¤è¿”å›åŸå§‹ä»·æ ¼
    }
}
```

(4) å…·ä½“è£…é¥°å™¨

```java
// å…·ä½“è£…é¥°å™¨ï¼šç‰›å¥¶
public class MilkDecorator extends CoffeeDecorator {
    public MilkDecorator(Coffee coffee) {
        super(coffee);
    }

    @Override
    public String getDescription() {
        return super.getDescription() + " + ç‰›å¥¶";
    }

    @Override
    public double getCost() {
        return super.getCost() + 2.0; // åŠ ç‰›å¥¶é¢å¤–æ”¶è´¹ 2 å…ƒ
    }
}

// å…·ä½“è£…é¥°å™¨ï¼šç³–
public class SugarDecorator extends CoffeeDecorator {
    public SugarDecorator(Coffee coffee) {
        super(coffee);
    }

    @Override
    public String getDescription() {
        return super.getDescription() + " + ç³–";
    }

    @Override
    public double getCost() {
        return super.getCost() + 1.0; // åŠ ç³–é¢å¤–æ”¶è´¹ 1 å…ƒ
    }
}
```

(6)æµ‹è¯•è£…é¥°å™¨æ¨¡å¼

```java
public class DecoratorPatternDemo {
    public static void main(String[] args) {
        Coffee coffee = new SimpleCoffee();
        System.out.println(coffee.getDescription() + " -> ä»·æ ¼: " + coffee.getCost());

        // åŠ ç‰›å¥¶
        coffee = new MilkDecorator(coffee);
        System.out.println(coffee.getDescription() + " -> ä»·æ ¼: " + coffee.getCost());

        // åŠ ç³–
        coffee = new SugarDecorator(coffee);
        System.out.println(coffee.getDescription() + " -> ä»·æ ¼: " + coffee.getCost());
    }
}
```

## èŠèŠç½‘ç»œï¼Œäº¤æ¢æœºå’Œè·¯ç”±å™¨çš„åŒºåˆ«ï¼Ÿ ##

**äº¤æ¢æœº**ï¼šä¸»è¦å·¥ä½œåœ¨**æ•°æ®é“¾è·¯å±‚**ã€‚å®ƒé€šè¿‡å­¦ä¹ è¿æ¥åˆ°å…¶ç«¯å£çš„è®¾å¤‡çš„ **MAC åœ°å€**ï¼Œæ„å»º MAC åœ°å€è¡¨ã€‚å½“æ¥æ”¶åˆ°æ•°æ®å¸§æ—¶ï¼Œæ ¹æ®æ•°æ®å¸§ä¸­çš„ç›®çš„ MAC åœ°å€åœ¨ MAC åœ°å€è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„ç«¯å£ï¼Œç„¶åå°†æ•°æ®å¸§ä»è¯¥ç«¯å£è½¬å‘å‡ºå»ï¼Œå®ç°æœ¬åœ°ç½‘ç»œå†…è®¾å¤‡ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚

**è·¯ç”±å™¨**ï¼šä¸»è¦å·¥ä½œåœ¨**ç½‘ç»œå±‚**ã€‚å®ƒä¾æ® **IP åœ°å€**è¿›è¡Œæ•°æ®è½¬å‘ï¼Œè·¯ç”±å™¨ä¸­ä¿å­˜ç€è·¯ç”±è¡¨ï¼Œè·¯ç”±è¡¨åŒ…å«äº†ç½‘ç»œåœ°å€ä¸ä¸‹ä¸€è·³åœ°å€ç­‰ä¿¡æ¯ã€‚å½“è·¯ç”±å™¨æ¥æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œä¼šæ ¹æ®æ•°æ®åŒ…ä¸­çš„ç›®çš„ IP åœ°å€ï¼Œåœ¨è·¯ç”±è¡¨ä¸­æŸ¥æ‰¾æœ€ä½³è·¯å¾„ï¼Œç„¶åå°†æ•°æ®åŒ…æ²¿ç€è¯¥è·¯å¾„è½¬å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æˆ–ç›®æ ‡è®¾å¤‡ã€‚

## ç°åœ¨æˆ‘ä»¬è§†é¢‘èŠå¤©ï¼Œæ¶‰åŠåˆ°çš„ç½‘ç»œåè®®æ˜¯ä»€ä¹ˆï¼Ÿ ##

å¯¹äºå®æ—¶æ€§è¦æ±‚æé«˜çš„è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®ï¼Œä¼šä¼˜å…ˆä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ï¼Œå¹¶é€šè¿‡ä¸€äº›é¢å¤–çš„æŠ€æœ¯æ‰‹æ®µæ¥å¼¥è¡¥ UDP çš„ä¸å¯é æ€§ï¼›è€Œå¯¹äºæ§åˆ¶ä¿¡æ¯å’Œä¸€äº›å¯¹å¯é æ€§è¦æ±‚è¾ƒé«˜çš„æ•°æ®ï¼Œåˆ™ä¼šä½¿ç”¨ TCP æ¥ä¼ è¾“ï¼Œä»¥ç¡®ä¿è§†é¢‘èŠå¤©çš„ç¨³å®šæ€§å’Œæ­£ç¡®æ€§ã€‚

è§†é¢‘èŠå¤©æ—¶ï¼Œ**UDP+RTP** ä¼ è¾“éŸ³è§†é¢‘æ•°æ®ï¼Œ**TCP** è´Ÿè´£ä¿¡ä»¤æ§åˆ¶ï¼ŒSTUN/TURN/ICE è§£å†³ P2P è¿æ¥é—®é¢˜ï¼Œæœ€ç»ˆé€šè¿‡ IP ç½‘ç»œã€Wi-Fiã€ç§»åŠ¨ç½‘ç»œç­‰è¿›è¡Œä¼ è¾“ã€‚

ç”¨ä¸€ä¸ªæ¡ˆä¾‹åŠ å¼ºä¸€ä¸‹è¯´æœåŠ›ï¼š

å³ä½¿ç½‘ç»œæ³¢åŠ¨è¾ƒå¤§ï¼ŒéŸ³è§†é¢‘æ•°æ®ä»ç„¶èƒ½å¤Ÿç»´æŒæµç•…ï¼Œè€Œæ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚æŒ‚æ–­é€šè¯ï¼‰åˆ™æ€»æ˜¯èƒ½å¯é åœ°ä¼ è¾“çš„åŸå› ã€‚